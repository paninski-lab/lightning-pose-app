<dialog #dlg class="modal" (cancel)="$event.preventDefault(); closeDialog()">
  <div
    class="modal-box overflow-x-hidden w-11/12 max-w-5xl h-[80vh] max-h-[90vh]"
  >
    <div class="flex flex-col h-full">
      <button
        class="btn btn-md btn-circle btn-ghost absolute right-4 top-4"
        (click)="closeDialog()"
        aria-label="Close import session dialog"
      >
        âœ•
      </button>
      <h3 class="text-xl font-bold mb-2">Import session</h3>
      <p class="text-sm mb-4">
        Select one or more local video files to upload. Filenames must follow
        the
        <code class="code">session_view.ext</code> pattern. Only alphanumeric,
        dash and underscore are allowed before the extension.
      </p>

      <div class="flex gap-3 items-center mb-4 flex-shrink-0">
        <label
          class="btn btn-primary"
          [class.btn-disabled]="uploading()"
          for="videoFileInput"
          >Choose videos</label
        >
        <input
          id="videoFileInput"
          type="file"
          #fileInput
          class="hidden"
          [disabled]="uploading()"
          (change)="addFiles(fileInput.files)"
          accept="video/*"
          multiple
        />
        <button
          class="btn btn-ghost"
          (click)="clearAll()"
          [disabled]="items().length === 0 || uploading()"
        >
          Clear selection
        </button>
      </div>

      <div
        class="overflow-y-auto grow min-h-0 border rounded-box"
        role="region"
        aria-label="Selected videos"
      >
        <app-video-file-table
          [items]="items()"
          [uploading]="uploading()"
          (removeAt)="removeAt($event)"
        />
      </div>

      <div class="flex justify-between items-center mt-6 flex-shrink-0">
        <div class="text-sm" [class.text-error]="!allValid()">
          @if (!allValid() && items().length > 0) {
            Fix invalid filenames before continuing.
          }
          @if (importAttempted() && hasErrors()) {
            <span class="text-error font-bold"
              >Some tasks failed. Click Import to retry.</span
            >
          }
        </div>
        <div class="flex gap-2">
          <button class="btn btn-outline" (click)="closeDialog()">
            Cancel
          </button>
          @if (uploading()) {
            <span
              class="loading loading-spinner loading-sm"
              aria-label="Importing"
            ></span>
          }
          <button
            class="btn btn-primary"
            [disabled]="!allValid() || uploading()"
            (click)="startImport()"
          >
            Import
          </button>
        </div>
      </div>
    </div>
  </div>
</dialog>
