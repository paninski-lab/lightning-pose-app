<style>
  ::placeholder {
    /** bring back the default style from daisy. dont know why it's getting overridden. */
    color: color-mix(in oklch, currentColor 50%, #0000) !important;
  }
</style>

<div class="flex flex-col h-full">
  @if (!setupMode()) {
    <button
      class="btn btn-md btn-circle btn-ghost absolute right-4 top-4"
      (click)="done.emit(null)"
    >
      âœ•
    </button>
  }
  <h3 class="text-xl font-bold mb-4 shrink-0">
    @if (!setupMode()) {
      Project settings
    } @else {
      Create project
    }
  </h3>

  <div class="flex gap-2 w-full grow shrink min-h-0">
    <ul class="menu min-w-40">
      <li>
        <a
          [class.menu-active]="selectedTab() === 'directories'"
          tabindex="0"
          (click)="handleTabClick('directories')"
          (keydown.enter)="handleTabClick('directories')"
        >
          <span class="material-icons text-sm!">folder</span>Local setup</a
        >
      </li>
      <li>
        <a
          [class.menu-active]="selectedTab() === 'keypoints'"
          tabindex="0"
          (click)="handleTabClick('keypoints')"
          (keydown.enter)="handleTabClick('keypoints')"
          ><span class="material-icons text-sm!">adjust</span>Keypoints</a
        >
      </li>
      <li>
        <a
          [class.menu-active]="selectedTab() === 'multiview'"
          tabindex="0"
          (click)="handleTabClick('multiview')"
          (keydown.enter)="handleTabClick('multiview')"
          ><span class="material-icons text-sm!">camera_alt</span>Multiview</a
        >
      </li>
    </ul>
    <div class="divider divider-vertical"></div>
    <div class="overflow-y-auto">
      @if (selectedTab() === "directories") {
        <form [formGroup]="projectInfoForm" class="prose px-4">
          <p class="m-0! text-sm">
            Settings specific to this machine, stored in
            <code>~/.lightning-pose/projects.toml</code>
          </p>
          <fieldset class="fieldset">
            <h3 class="text-md">Data directory</h3>
            <p class="m-0!">
              The root of the data directory. Contains all data used to train
              models, and the <code>project.yaml</code> metadata file. The
              directory will be created if it doesn't exist.
            </p>

            <div class="input w-full">
              <span class="material-icons !text-sm opacity-50">folder</span>
              <input
                formControlName="dataDir"
                type="text"
                class="grow"
                placeholder="/"
                spellcheck="false"
              />
            </div>
          </fieldset>

          <fieldset class="fieldset">
            <h3 class="text-md">Model directory</h3>
            <p class="m-0!">The directory containing the project's models.</p>

            <div class="flex gap-2">
              <input
                type="checkbox"
                class="checkbox"
                formControlName="useDefaultModelDir"
              />
              <span class="m-0!">
                Use the default model directory:<br />
                <div class="inline-block w-4"></div>
                <code>DATA_DIR&nbsp;/&nbsp;models&nbsp;/</code>
              </span>
            </div>

            <div class="input w-full">
              <span class="material-icons !text-sm opacity-50">folder</span>
              <input
                formControlName="modelDir"
                type="text"
                class="grow"
                placeholder="/"
                spellcheck="false"
              />
            </div>
          </fieldset>
        </form>
      }
      @if (selectedTab() === "multiview") {
        <form [formGroup]="projectInfoForm" class="prose px-4">
          <fieldset class="fieldset my-6">
            <h3 class="text-md mt-0!">Camera view names</h3>
            <p class="m-0!">
              Enter the names of the camera views, or leave blank if this is a
              single view project.
            </p>
            <p class="m-0!">
              Used to group multiview files. Sessions are identified by removing
              the view name from the video filename. Label CSV files are
              similarly grouped.
            </p>
            <p class="m-0!">
              Filenames should embed the view name delimited by underscore or
              hyphen. For example,
              <code>video_01_front.mp4</code> or
              <code>video_01-front.mp4</code> are valid, but not
              <code>video_01front.mp4</code>.
            </p>
            <textarea
              class="textarea w-full"
              [rows]="viewsInitialRows()"
              [placeholder]="cameraViewPlaceholder"
              formControlName="views"
              spellcheck="false"
            ></textarea>
            <p>
              Parsed:
              {{ parseTextAsList(projectInfoForm.get("views")?.value) | json }}
            </p>
          </fieldset>
        </form>
      }
      @if (selectedTab() === "keypoints") {
        <form [formGroup]="projectInfoForm" class="prose px-4">
          <fieldset class="fieldset my-6">
            <h3 class="text-md mt-0!">Keypoint names</h3>
            <p class="m-0!">
              Enter the names of the keypoints to label. This is also the
              labeling order of the keypoints.
            </p>
            <textarea
              class="textarea w-full"
              [rows]="keypointInitialRows()"
              formControlName="keypointNames"
              spellcheck="false"
            ></textarea>
            <p>
              Parsed:
              {{
                parseTextAsList(projectInfoForm.get("keypointNames")?.value)
                  | json
              }}
            </p>
          </fieldset>
        </form>
      }
    </div>
  </div>
  <footer class="shrink-0 modal-action">
    <p class="text-sm text-info">{{ saveSuccessMessage() }}</p>
    <button
      class="btn btn-soft btn-primary"
      (click)="onSaveClick()"
      [disabled]="!projectInfoForm.dirty"
    >
      Save
    </button>
  </footer>
</div>
