<style>
  :host {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  .navbar {
    min-height: 3rem; /* reduce from default of 4rem */
  }
</style>
<header>
  <nav class="navbar bg-base-200 shadow-lg">
    <div class="navbar-start">
      <a href="/"><span class="text-lg font-semibold">Lightning Pose</span></a>
      @if (projectKey()) {
        <span class="ml-3 text-base-content/70" aria-label="Current project"
          >â€” {{ projectKey() }}</span
        >
      }
    </div>

    <div class="navbar-center">
      <ul class="menu menu-horizontal p-0">
        @for (entry of navLinks(); track entry.text) {
          <li>
            <a
              [routerLink]="entry.link"
              routerLinkActive="menu-active"
              ariaCurrentWhenActive="page"
              >{{ entry.text }}</a
            >
          </li>
        }
      </ul>
    </div>

    <div class="navbar-end">
      @if (fineVideoService.numPendingTranscodeTasks().pending > 0) {
        <div
          class="tooltip tooltip-left"
          [attr.data-tip]="
            'Transcoding videos: ' +
            fineVideoService.numPendingTranscodeTasks().pending.toString() +
            ' remaining'
          "
        >
          <span class="loading loading-bars loading-xs"></span>
        </div>
      }

      <!-- Settings button using routerLink to open the dialog -->
      <a
        class="btn btn-ghost"
        tabindex="0"
        [routerLink]="[]"
        [queryParams]="{ settingsOpen: 'true' }"
        queryParamsHandling="merge"
      >
        <span class="material-icons">settings</span>
      </a>
    </div>
  </nav>
</header>

<!-- Context loading spinner (resolver-driven) -->
<div class="fixed top-4 right-4 z-50" aria-live="polite">
  @if (loadingService.isContextLoading()) {
    <span class="loading loading-spinner loading-lg text-primary"></span>
  }
  @if (fineVideoService.numPendingTranscodeTasks().pending > 0) {
    <div
      class="tooltip tooltip-left"
      [attr.data-tip]="
        'Transcoding videos: ' +
        fineVideoService.numPendingTranscodeTasks().pending.toString() +
        ' remaining'
      "
    >
      <span class="loading loading-bars loading-xs"></span>
    </div>
  }
</div>

<!-- Set min-height: 0 to allow it to shrink if its content is too large.
  Default min-height for flex items is auto. -->
<main class="flex-grow flex min-h-0">
  <router-outlet />
</main>

<!-- Settings dialog -->
<dialog #settingsDialog class="modal">
  @if (settingsDialogOpen()) {
    <app-project-settings
      class="modal-box w-5/6 max-w-3xl h-2/3 max-h-150"
      [setupMode]="settingsSetupMode()"
      [projectKey]="settingsProjectKey()"
      (doneCreation)="handleSettingsDialogDoneCreation($event)"
      (closeButtonClick)="closeSettingsDialog()"
    ></app-project-settings>

    <!-- Makes the dialog close when clicked from outside. -->
    <div class="modal-backdrop">
      <button (click)="closeSettingsDialog()">close</button>
    </div>
  }
</dialog>
